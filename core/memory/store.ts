import type { Memory } from '@/types/memory';
const STOP = new Set('the a an is are was were be been being have has had do does did will would could should may might must can to of in for on with at by from as or and but not it its'.split(' '));
function tokenize(text) { return new Set(text.toLowerCase().replace(/[^\w\s]/g,' ').split(/\s+/).filter(w=>w.length>1&&!STOP.has(w))); }
function scoreRelevance(memory, queryTokens) { const ct=tokenize(memory.content); const tt=new Set((memory.tags||[]).map(t=>t.toLowerCase())); let s=0; for(const t of queryTokens) if(ct.has(t)||tt.has(t)) s++; return s; }
const memories=[{id:'mem-1',content:'Host bought a cat-themed meme coin. Lost 20%.',createdAt:Date.now()-86400*14,tags:['meme','cat','coin','buy','loss','shitcoin']},{id:'mem-2',content:'Host FOMOed into a pump. Entered late, exited at a loss.',createdAt:Date.now()-86400*7,tags:['fomo','pump','loss']},{id:'mem-3',content:'Host held through -40% drawdown.',createdAt:Date.now()-86400*21,tags:['hold','drawdown']},{id:'mem-4',content:'Host took profit at 2x. Did not chase.',createdAt:Date.now()-86400*3,tags:['profit','discipline']},{id:'mem-5',content:'Host skipped trade due to anxiety.',createdAt:Date.now()-86400*10,tags:['anxiety','skip']}];
export function getRelevantMemories(queryText,limit=5) { if(!queryText.trim()) return memories.slice().sort((a,b)=>b.createdAt-a.createdAt).slice(0,limit); const qt=tokenize(queryText); const scored=memories.map(m=>({memory:m,score:scoreRelevance(m,qt)})).filter(x=>x.score>0).sort((a,b)=>b.score-a.score||b.memory.createdAt-a.memory.createdAt); return scored.slice(0,limit).map(x=>x.memory); }
export function addMemory(content,tags) { const m={id:'mem-'+Date.now()+'-'+Math.random().toString(36).slice(2,8),content,createdAt:Date.now(),tags}; memories.push(m); return m; }